import{c as m,a as v,j as e,r as d,M as w,l as k}from"./index-FYbViIFO.js";import{S as _}from"./search-DhGXtb4p.js";const C=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],T=m("calendar",C);const L=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],M=m("check",L);const S=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],D=m("chevron-down",S);const $=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],P=m("chevron-up",$);const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],I=m("circle-x",q);const A=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],U=m("clock",A);const z=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],R=m("credit-card",z);const E=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],H=m("quote",E);const F=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],V=m("rotate-ccw",F);const G=[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]],y=m("sticky-note",G);const O=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Q=m("wallet",O);async function X(t){const n=t?.page?Number(t.page):1,i=(n-1)*20,r={};t?.search&&(r.search=t.search),t?.topUpType&&(r.topUpType=t.topUpType),t?.status&&(r.status=t.status),t?.startDate&&(r.startDate=t.startDate),t?.endDate&&(r.endDate=t.endDate),r.page=n,r.limit=20,r.skip=i;const c="?"+new URLSearchParams(r).toString(),l=await(await v.get(`payment-requests${c}`)).data,a=l.data.map(s=>({id:s._id,email:s.userEmail,status:s.status,amount:s.amount,method:s.transferType,type:s.type,planInfo:s.type==="membership"?`Nạp Membership ${s.premiumDays||1} ngày`:`Nạp Tiên Ngọc: ${s.tienNgoc||0} viên`,premiumDays:s.premiumDays||0,gemAmount:s.tienNgoc||0,transferContent:s.content||"",createdAt:s.createdAt,adminNote:s.adminNote||"",userNote:s.userNote||"",paymentProofURL:s.paymentProofURL}));return{page:l.page||n,limit:20,total:l.total||a.length,totalPages:l.totalPages||1,requests:a}}function K({search:t,setSearch:o,statusFilter:n,setStatusFilter:i,dateRange:r,setDateRange:c}){const x=a=>{const s=new Date,h=new Date;a===0?h.setHours(0,0,0,0):h.setDate(s.getDate()-a),c({start:h.toISOString().split("T")[0],end:s.toISOString().split("T")[0]})},l=()=>c({start:"",end:""});return e.jsxs("div",{className:"flex gap-4 flex-col mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 relative",children:[e.jsx(_,{className:"w-5 h-5 absolute left-3 text-gray-800"}),e.jsx("input",{type:"text",placeholder:"Tìm theo email hoặc nội dung...",value:t,onChange:a=>o(a.target.value),className:"flex-1 px-9 py-2 rounded-lg border text-slate-200 text-sm placeholder:text-slate-500"})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:["ALL","pending","approved","rejected"].map(a=>{const s=n===a,h=a==="ALL"?"Tất cả":a==="pending"?"Chờ kiểm tra":a==="approved"?"Thành công":"Thất bại";return e.jsx("button",{onClick:()=>i(a),className:`
                text-sm px-3 py-1.5 rounded-lg border transition-all duration-200 cursor-pointer
                ${s?"bg-emerald-500 text-white":"bg-gray-400  text-white"}
              `,children:h},a)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Lọc theo ngày tạo"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(0),className:"text-xs px-2 py-1 rounded-md bg-emerald-400 text-white hover:bg-emerald-500 cursor-pointer",children:"Hôm nay"}),e.jsx("button",{onClick:()=>x(7),className:"text-xs px-2 py-1 rounded-md bg-blue-400 text-white hover:bg-blue-500 cursor-pointer",children:"7 ngày"}),e.jsx("button",{onClick:()=>x(30),className:"text-xs px-2 py-1 rounded-md bg-indigo-500 text-white hover:bg-indigo-600 cursor-pointer",children:"30 ngày"}),e.jsxs("button",{onClick:l,className:"text-xs px-2 py-1 rounded-md flex items-center gap-1 cursor-pointer bg-slate-500 text-white hover:bg-slate-600",children:[e.jsx(V,{className:"w-3.5 h-3.5"})," Reset"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"date",value:r.start,onChange:a=>c(s=>({...s,start:a.target.value})),className:`\r
              w-full sm:w-1/2 px-3 py-2 rounded-lg text-sm\r
              border border-emerald-900/30 bg-[#0b1017]/90 text-slate-200\r
              focus:outline-none focus:ring-2 focus:ring-emerald-500/40\r
              hover:border-emerald-600/40 transition\r
            `}),e.jsx("input",{type:"date",value:r.end,onChange:a=>c(s=>({...s,end:a.target.value})),className:`\r
              w-full sm:w-1/2 px-3 py-2 rounded-lg text-sm\r
              border border-emerald-900/30 bg-[#0b1017]/90 text-slate-200\r
              focus:outline-none focus:ring-2 focus:ring-emerald-500/40\r
              hover:border-emerald-600/40 transition\r
            `})]})]})]})}function W({userNote:t,adminNote:o,onChange:n}){return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{className:"w-4 h-4 text-emerald-400/80"}),e.jsx("span",{className:"font-medium text-emerald-100",children:"Ghi chú từ người dùng:"})]}),e.jsx("textarea",{className:`\r
            w-full rounded-lg px-3 py-2.5 text-sm text-emerald-100\r
            bg-[#0b1413]/80 border border-emerald-800/50 \r
            placeholder:text-emerald-400/30 \r
            focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-600/60\r
            transition-all duration-200 resize-none\r
          `,rows:2,value:t,onChange:i=>n("userNote",i.target.value),placeholder:"Không có ghi chú từ người dùng..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{className:"w-4 h-4 text-rose-400/80"}),e.jsx("span",{className:"font-medium text-rose-100",children:"Ghi chú nội bộ (Admin):"})]}),e.jsx("textarea",{className:`\r
            w-full rounded-lg px-3 py-2.5 text-sm text-rose-100\r
            bg-[#130b0c]/70 border border-rose-800/50 \r
            placeholder:text-rose-400/30 \r
            focus:outline-none focus:ring-2 focus:ring-rose-500/40 focus:border-rose-600/60\r
            transition-all duration-200 resize-none\r
          `,rows:2,value:o,onChange:i=>n("adminNote",i.target.value),placeholder:"Chỉ hiển thị cho admin..."})]})]})}function Z(t){if(!t)return"-";const o=new Date(t);return isNaN(o.getTime())?"-":o.toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"numeric"})}function B({item:t,onStatusChange:o}){const[n,i]=d.useState(!1),[r,c]=d.useState(null),[x,l]=d.useState({userNote:t.userNote??"",adminNote:t.adminNote??""});d.useEffect(()=>{l({userNote:t.userNote??"",adminNote:t.adminNote??""})},[t.userNote,t.adminNote]);const a={label:"Chờ kiểm tra",badge:"bg-amber-900/30 text-amber-300 border-amber-700/40",icon:"text-amber-300"},s={pending:{label:"Chờ kiểm tra",badge:"bg-amber-900/30 text-amber-300 border-amber-700/40",icon:"text-amber-300"},approved:{label:"Thành công",badge:"bg-emerald-900/30 text-emerald-300 border-emerald-700/40",icon:"text-emerald-300"},rejected:{label:"Thất bại",badge:"bg-rose-900/30 text-rose-300 border-rose-700/40",icon:"text-rose-300"}}[t.status||"pending"]||a,h=d.useCallback(async()=>{try{const p=await v.post("/payment-requests/approve",{paymentRequestId:t.id});console.log("Approve success:",p.data),o(t.id,"approved")}catch(p){console.error("Approve error:",p.response?.data||p.message),alert("Xử lý thất bại!")}},[t.id,o]),b=()=>{o(t.id,"rejected")};return e.jsxs("div",{className:`
        rounded-xl p-4 sm:p-5
        bg-[#0c1513]/80 backdrop-blur-sm
        border border-emerald-800/40
        shadow-[0_0_12px_rgba(16,185,129,0.05)]
        transition duration-300
        hover:shadow-[0_0_20px_rgba(16,185,129,0.12)]
        hover:border-emerald-600/40
      `,children:[e.jsxs("button",{onClick:()=>i(!n),className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 text-left",children:[e.jsx(Q,{className:`w-5 h-5 ${s.icon}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-emerald-50",children:t.email}),e.jsxs("div",{className:"text-xs text-emerald-300/70",children:[t.type," •"," ",t.type==="membership"?`${t.premiumDays||0} ngày`:`${t.gemAmount||0} Tiên Ngọc`]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 border rounded-md ${s.badge}`,children:s.label}),n?e.jsx(P,{className:"w-5 h-5 text-emerald-300/70"}):e.jsx(D,{className:"w-5 h-5 text-emerald-300/70"})]})]}),n&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-emerald-800/30 text-sm text-emerald-100 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-200/90",children:[e.jsx(U,{className:"w-4 h-4 text-emerald-400/70"}),e.jsx("span",{className:"font-medium",children:"Thời gian tạo:"})," ",Z(t.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-emerald-400/70"}),e.jsx("span",{className:"font-medium",children:"Email:"})," ",t.email]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(H,{className:"w-4 h-4 text-emerald-400/70"}),e.jsx("span",{className:"font-medium",children:"Nội dung chuyển khoản:"})]}),e.jsxs("blockquote",{className:"border-l-4 border-emerald-700/40 bg-emerald-950/40 p-3 rounded-md italic text-emerald-100",children:["“",t.transferContent??"","”"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-emerald-400/70"}),e.jsx("span",{className:"font-medium",children:"Phương thức:"})," ",t.method??"-"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-emerald-400/70"}),e.jsx("span",{className:"font-medium",children:"Hình thức nạp:"})," ",t.type??"-"]}),t.paymentProofURL&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"font-medium",children:"Hình xác nhận thanh toán:"}),e.jsx("img",{src:t.paymentProofURL,alt:"Payment Proof",className:"w-[200px] h-[300px] object-cover rounded-lg border border-emerald-700/30 cursor-pointer hover:opacity-80 transition",onClick:()=>c(t.paymentProofURL)})]})]}),e.jsx(W,{userNote:x.userNote,adminNote:x.adminNote,onChange:(p,N)=>l(u=>({...u,[p]:N}))}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[t.status==="pending"&&e.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-emerald-700 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition",children:[e.jsx(M,{className:"w-4 h-4"}),"Xử lý giao dịch"]}),t.status!=="approved"&&e.jsxs("button",{onClick:b,className:"flex items-center gap-2 bg-rose-700 hover:bg-rose-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition",children:[e.jsx(I,{className:"w-4 h-4"}),"Đánh dấu thất bại"]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[999]",onClick:()=>c(null),children:e.jsx("img",{src:r,alt:"Preview",className:"max-w-[90vw] max-h-[90vh] rounded-lg shadow-xl"})})]})}function J({topUpType:t}){const[o,n]=d.useState([]),[i,r]=d.useState(!0),[c,x]=d.useState(""),[l,a]=d.useState("ALL"),[s,h]=d.useState({start:"",end:""}),[b,p]=d.useState(1),N=(u,g)=>{n(j=>j.map(f=>f.id===u?{...f,status:g}:f))};return d.useEffect(()=>{(async()=>{r(!0);try{const g=await X({search:c,status:l==="ALL"?"":l.toLowerCase(),startDate:s.start,endDate:s.end,page:b,topUpType:t});n(g.requests)}catch(g){console.error(g)}finally{r(!1)}})()},[c,l,s,b,t]),e.jsx("div",{className:"min-h-screen w-full py-10 bg-white text-gray-800",children:e.jsxs("div",{className:"mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-cinzel font-bold mb-4 text-gray-800 drop-shadow-[0_0_8px_rgba(16,185,129,0.4)] tracking-wide",children:"Quản lý Giao Dịch"}),e.jsx(K,{search:c,setSearch:x,statusFilter:l,setStatusFilter:a,dateRange:s,setDateRange:h}),i?e.jsx("div",{className:"text-center text-slate-500 py-12 animate-pulse",children:"Đang tải dữ liệu..."}):o.length===0?e.jsx("div",{className:"text-center text-slate-500 italic py-12",children:"Không tìm thấy giao dịch nào."}):e.jsx("div",{className:"space-y-4",children:o.map(u=>e.jsx("div",{className:`\r
                  bg-[#0d1118] border border-slate-800/70 rounded-xl p-[1px]\r
                  hover:border-emerald-500/40 transition-all duration-300\r
                  hover:shadow-[0_0_12px_rgba(16,185,129,0.15)]\r
                `,children:e.jsx(B,{item:u,onStatusChange:N})},u.id))})]})})}function te({topUpType:t}){return e.jsx(J,{topUpType:t})}export{te as default};
