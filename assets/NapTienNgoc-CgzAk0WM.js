import{c as n,r as s,j as e,C as z,i,k as o}from"./index-CahjfAcq.js";import{S as I}from"./search-DnzrFR2_.js";import{m as h}from"./proxy-BZUTFNq_.js";import{A as q}from"./index-SQYwfEKS.js";import{X as V}from"./x-D2WlVzxj.js";const D=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],F=n("circle-plus",D);const K=[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],T=n("circle-user-round",K);const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],P=n("globe",G);const Q=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],R=n("history",Q);const X=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],x=n("loader-circle",X);const B=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],_=n("scroll-text",B);const O=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Y=n("users",O);function ae(){const[p,g]=s.useState([]),[y,M]=s.useState([]),[u,N]=s.useState([]),[L,j]=s.useState(!0),[A,b]=s.useState(!0),[C,f]=s.useState(!1),[l,U]=s.useState(null),[E,w]=s.useState(!1),[d,v]=s.useState(""),[m,$]=s.useState("");s.useEffect(()=>{(async()=>{try{j(!0);const c=(await i.get(o("users"))).data?.data||[];g(c.map(a=>({id:a._id,email:a.email,balance:a.tienNgoc||0})))}catch(r){console.error("❌ Fetch users error:",r)}finally{j(!1)}})()},[]),s.useEffect(()=>{(async()=>{try{b(!0);const c=(await i.get(o("transactions/all"))).data?.transactions||[];M(c.map(a=>({id:a._id,userEmail:a.userId?.email||"Không rõ",type:a.type,amount:a.amount,createdAt:a.createdAt})))}catch(r){console.error("❌ Fetch all transactions error:",r)}finally{b(!1)}})()},[]);const k=async t=>{f(!0);try{const c=(await i.get(o(`transactions/user/${t}`))).data?.transactions||[];console.log("data user transaction",c),N(c.map(a=>({id:a._id,userEmail:a.user?.email||"Không rõ",type:a.type,amount:a.amount,createdAt:a.createdAt})))}catch(r){console.error("❌ Fetch user transactions error:",r),N([])}finally{f(!1)}},H=async()=>{if(!l||!d)return;const t=parseInt(d);if(isNaN(t)||t<=0)return alert("Số tiên ngọc không hợp lệ.");try{await i.post(o("transactions"),{userId:l.id,type:"BUY_TIEN_NGOC",amount:t,topupAmount:t,description:"Nạp Tiên Ngọc thủ công thông qua Admin"}),alert("✅ Nạp thành công!"),g(r=>r.map(c=>c.id===l.id?{...c,balance:c.balance+t}:c)),v(""),k(l.id)}catch(r){console.error("❌ Topup error:",r),alert("Lỗi khi nạp tiên ngọc.")}};s.useEffect(()=>{document.title="Quản lí Tiên Ngọc"},[]);const S=s.useMemo(()=>p.filter(t=>t.email.toLowerCase().includes(m.toLowerCase())),[p,m]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 to-sky-50 p-8",children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-10",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h1",{className:"text-3xl font-bold text-emerald-700 flex items-center gap-2",children:[e.jsx(z,{className:"w-7 h-7 text-emerald-500"}),"Quản lý Tiên Ngọc"]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(I,{className:"absolute left-3 top-3 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Tìm theo email...",value:m,onChange:t=>$(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-emerald-200 rounded-lg focus:ring-2 focus:ring-emerald-400 focus:outline-none"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-emerald-100 p-3 border-b border-emerald-200",children:[e.jsx(Y,{className:"text-emerald-700 w-5 h-5"}),e.jsx("h2",{className:"text-emerald-700 font-semibold",children:"Danh sách người dùng"})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-emerald-50 text-emerald-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Email"}),e.jsx("th",{className:"text-right px-4 py-3",children:"Tiên Ngọc"}),e.jsx("th",{className:"text-center px-4 py-3",children:"Hành động"})]})}),e.jsx("tbody",{children:L?e.jsx("tr",{children:e.jsxs("td",{colSpan:3,className:"text-center py-6 text-gray-400",children:[e.jsx(x,{className:"inline w-5 h-5 animate-spin mr-2"}),"Đang tải..."]})}):S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:3,className:"text-center py-6 text-gray-400 italic",children:[e.jsx(T,{className:"inline w-5 h-5 mr-2"}),"Không có người dùng."]})}):S.map(t=>e.jsxs("tr",{className:"border-t border-emerald-100 hover:bg-emerald-50 transition",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-emerald-700",children:t.email}),e.jsx("td",{className:"px-4 py-3 text-right text-emerald-600 font-medium",children:t.balance.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs(h.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{U(t),k(t.id),w(!0)},className:"inline-flex items-center gap-2 bg-gradient-to-r from-emerald-500 to-sky-400 text-white px-4 py-2 rounded-lg font-medium shadow-md",children:[e.jsx(F,{className:"w-4 h-4"})," Nạp"]})})]},t.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-amber-100 p-3 border-b border-amber-200",children:[e.jsx(P,{className:"text-amber-700 w-5 h-5"}),e.jsx("h2",{className:"text-amber-700 font-semibold",children:"Lịch sử giao dịch toàn hệ thống"})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-amber-50 text-amber-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Email"}),e.jsx("th",{className:"text-center px-4 py-3",children:"Loại"}),e.jsx("th",{className:"text-right px-4 py-3",children:"Số tiên ngọc"}),e.jsx("th",{className:"text-right px-4 py-3",children:"Thời gian"})]})}),e.jsx("tbody",{children:A?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-6 text-gray-400",children:[e.jsx(x,{className:"inline w-5 h-5 animate-spin mr-2"}),"Đang tải..."]})}):y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-6 text-gray-400 italic",children:[e.jsx(_,{className:"inline w-5 h-5 mr-2"}),"Chưa có giao dịch nào."]})}):y.map(t=>e.jsxs("tr",{className:"border-t border-amber-100 hover:bg-amber-50 transition",children:[e.jsx("td",{className:"px-4 py-3 text-amber-700 font-medium",children:t.userEmail}),e.jsx("td",{className:"px-4 py-3 text-center text-xs font-semibold uppercase text-amber-600",children:t.type.replace(/_/g," ")}),e.jsx("td",{className:"px-4 py-3 text-right text-amber-700 font-medium",children:t.amount.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-500 text-sm",children:new Date(t.createdAt).toLocaleString("vi-VN")})]},t.id))})]})]})]}),e.jsx(q,{children:E&&l&&e.jsx(h.div,{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(h.div,{className:"bg-white p-6 rounded-2xl shadow-2xl w-full max-w-2xl relative overflow-y-auto max-h-[90vh]",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},children:[e.jsx("button",{onClick:()=>w(!1),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-emerald-700 flex items-center gap-2",children:[e.jsx(T,{className:"w-6 h-6 text-emerald-500"}),l.email]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm text-gray-600 font-medium mb-1 block",children:"Số tiên ngọc muốn nạp"}),e.jsx("input",{type:"number",value:d,onChange:t=>v(t.target.value),className:"w-full border border-emerald-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-400 focus:outline-none",placeholder:"Nhập số tiên ngọc..."}),e.jsx("button",{onClick:H,className:"w-full mt-4 bg-gradient-to-r from-emerald-500 to-sky-400 text-white font-medium py-2 rounded-lg hover:opacity-90 transition",children:"Xác nhận nạp"})]}),e.jsxs("div",{className:"mt-6 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 p-3 border-b border-gray-200",children:[e.jsx(R,{className:"text-gray-600 w-4 h-4"}),e.jsx("h3",{className:"text-gray-700 font-semibold text-sm",children:"Lịch sử giao dịch của người dùng"})]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-3 py-2",children:"Loại"}),e.jsx("th",{className:"text-right px-3 py-2",children:"Số tiên ngọc"}),e.jsx("th",{className:"text-right px-3 py-2",children:"Thời gian"})]})}),e.jsx("tbody",{children:C?e.jsx("tr",{children:e.jsxs("td",{colSpan:3,className:"text-center py-4 text-gray-400",children:[e.jsx(x,{className:"inline w-4 h-4 animate-spin mr-2"}),"Đang tải..."]})}):u.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:3,className:"text-center py-4 text-gray-400 italic",children:[e.jsx(_,{className:"inline w-4 h-4 mr-2"}),"Chưa có giao dịch nào."]})}):u.map(t=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 font-medium",children:t.type.replace(/_/g," ")}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-700 font-semibold",children:t.amount.toLocaleString()}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-500 text-xs",children:new Date(t.createdAt).toLocaleString("vi-VN")})]},t.id))})]})]})]})})})]})}export{ae as default};
